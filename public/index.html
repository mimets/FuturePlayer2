<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>FuturePlayer Premium</title>
<style>
body{font-family:Arial;color:#fff;background:#111;text-align:center;padding:40px;}
input,button{padding:8px;margin:5px;}
button{background:#1DB954;border:none;border-radius:5px;color:white;cursor:pointer;}
button:hover{background:#1ed760;}
#results button{display:block;margin:5px auto;width:90%;text-align:left;}
</style>
</head>
<body>
<h1>ðŸŽµ FuturePlayer Premium</h1>
<input type="text" id="searchInput" placeholder="Cerca artista o brano"/>
<button id="searchBtn">Cerca</button>
<div id="results"></div>

<script src="https://sdk.scdn.co/spotify-player.js"></script>
<script>
let token=null;

// Prende token dal server
async function getToken(){
  const res = await fetch('/token');
  const data = await res.json();
  token = data.access_token;
}
getToken();

// Inizializza Spotify Web Playback SDK
window.onSpotifyWebPlaybackSDKReady = () => {
  const player = new Spotify.Player({
    name: 'FuturePlayer',
    getOAuthToken: cb => { cb(token); },
    volume: 0.8
  });

  player.addListener('ready', ({device_id})=>{
    console.log('Device pronto', device_id);
    window.device_id = device_id;
  });

  player.connect();
};

// Funzione ricerca
document.getElementById('searchBtn').onclick = async () => {
  if(!token) { alert('Token non disponibile'); return; }
  const query = document.getElementById('searchInput').value.trim();
  if(!query) return;

  const res = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`,{
    headers:{Authorization:'Bearer '+token}
  });
  const data = await res.json();
  const container = document.getElementById('results');
  container.innerHTML='';

  data.tracks.items.forEach(track=>{
    const btn=document.createElement('button');
    btn.textContent = `${track.name} - ${track.artists.map(a=>a.name).join(', ')}`;
    btn.onclick=()=>{
      fetch(`https://api.spotify.com/v1/me/player/play?device_id=${window.device_id}`,{
        method:'PUT',
        body: JSON.stringify({uris:[track.uri]}),
        headers:{Authorization:'Bearer '+token,'Content-Type':'application/json'}
      });
    };
    container.appendChild(btn);
  });
};
</script>
</body>
</html>
